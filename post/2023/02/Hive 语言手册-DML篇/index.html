<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/logo.png"><title>Hive 基本概念 DML篇 | Xiaobailong</title><meta name="description" content="Xiaobailong's blog.">
    <link rel="modulepreload" href="/assets/app.7f79d2e7.js"><link rel="modulepreload" href="/assets/index.html.b082eec6.js"><link rel="modulepreload" href="/assets/index.html.e8c2580a.js"><link rel="prefetch" href="/assets/index.html.0bfc2a63.js"><link rel="prefetch" href="/assets/index.html.96d0d331.js"><link rel="prefetch" href="/assets/index.html.b339f918.js"><link rel="prefetch" href="/assets/index.html.de623cb7.js"><link rel="prefetch" href="/assets/index.html.f894b5dc.js"><link rel="prefetch" href="/assets/index.html.db9688e0.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/index.html.de26035a.js"><link rel="prefetch" href="/assets/index.html.4a704eac.js"><link rel="prefetch" href="/assets/index.html.64e1d95f.js"><link rel="prefetch" href="/assets/index.html.177c9b91.js"><link rel="prefetch" href="/assets/index.html.8f8264a6.js"><link rel="prefetch" href="/assets/index.html.7a47c908.js"><link rel="prefetch" href="/assets/index.html.deae5fb3.js"><link rel="prefetch" href="/assets/index.html.326c9086.js"><link rel="prefetch" href="/assets/index.html.bb3724b2.js"><link rel="prefetch" href="/assets/index.html.291dcd4a.js"><link rel="prefetch" href="/assets/index.html.ff07d35e.js"><link rel="prefetch" href="/assets/index.html.b2d8f580.js"><link rel="prefetch" href="/assets/index.html.98dcd658.js"><link rel="prefetch" href="/assets/404.html.f7ba0a0f.js"><link rel="prefetch" href="/assets/index.html.3a3f645d.js"><link rel="prefetch" href="/assets/index.html.ee2688a1.js"><link rel="prefetch" href="/assets/index.html.cf53be78.js"><link rel="prefetch" href="/assets/index.html.0f456be9.js"><link rel="prefetch" href="/assets/index.html.999e17d5.js"><link rel="prefetch" href="/assets/index.html.7efde9f8.js"><link rel="prefetch" href="/assets/index.html.c78de1fc.js"><link rel="prefetch" href="/assets/404.3c91153c.js"><link rel="prefetch" href="/assets/HomePage.8dd37360.js"><link rel="prefetch" href="/assets/Layout.a9b3424b.js"><link rel="prefetch" href="/assets/Links.0010d432.js"><link rel="prefetch" href="/assets/Post.823acb2f.js"><link rel="prefetch" href="/assets/Tags.30661a21.js">
    <link rel="stylesheet" href="/assets/style.d9da5232.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">$ cd /home/</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor"><!--[--><!--]--></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor"><!--[--><!--]--></svg></span><span>Links</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor"><!--[--><!--]--></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor"><!--[--><!--]--></svg></span><span>Links</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(/img/blog_cover/2022/12/2022-12-12-1.jpg);"><div class="article-header-mask" style="background:rgba(40, 57, 101, .4);"></div><div class="article-header-content"><div class="article-tags"><!--[--><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="article-tag">大数据</a><a href="/tags/hive/" class="article-tag">Hive</a><!--]--></div><h1 class="article-title">Hive 基本概念 DML篇</h1><p class="article-subtitle">随便看看，别要求太过分</p><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>Xiaobailong</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2023-02-09</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>19 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><!--]--><div><h1 id="hiveql-语言手册-dml篇" tabindex="-1"><a class="header-anchor" href="#hiveql-语言手册-dml篇" aria-hidden="true">#</a> HiveQL 语言手册 DML篇</h1><p>HiveQL DML 所包含的表达式语句如下：</p><ul><li>LOAD (加载)</li><li>INSERT (插入) <ul><li>into Hive tables from queries</li><li>into directories from queries</li><li>into Hive tables from SQL</li></ul></li><li>UPDATE (更新)</li><li>DELETE (删除)</li><li>MERGE (合并)</li><li>EXPORT (导出)</li><li>IMPORT (导入)</li></ul><h3 id="load" tabindex="-1"><a class="header-anchor" href="#load" aria-hidden="true">#</a> Load</h3><p>Hive在操作将数据加载到表中时不会进行任何转换。<code>LOAD</code>操作目前是纯粹的复制/移动操作，将数据文件复制/移动到对应Hive表的位置。</p><h5 id="load-语法" tabindex="-1"><a class="header-anchor" href="#load-语法" aria-hidden="true">#</a> Load 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> INPATH <span class="token string">&#39;filepath&#39;</span> <span class="token punctuation">[</span>OVERWRITE<span class="token punctuation">]</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
 
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> INPATH <span class="token string">&#39;filepath&#39;</span> <span class="token punctuation">[</span>OVERWRITE<span class="token punctuation">]</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INPUTFORMAT <span class="token string">&#39;inputformat&#39;</span> SERDE <span class="token string">&#39;serde&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">3.0</span> <span class="token operator">or</span> later<span class="token punctuation">)</span>
</code></pre></div><h5 id="load-概要" tabindex="-1"><a class="header-anchor" href="#load-概要" aria-hidden="true">#</a> Load 概要</h5><p>Hive 3.0之前的加载操作是纯粹的复制/移动操作，将数据文件移动到与Hive表对应的位置。</p><ul><li>文件路径可以是： <ul><li>相对路径，例如 ：<code>project/data1</code></li><li>绝对路径，例如 ：<code>/user/hive/project/data1</code></li><li>一个包含scheme和(可选)权限的完整URI，例如 ：<code>hdfs://namenode:9000/user/hive/project/data1</code></li></ul></li><li>加载的目标可以是一个表或一个分区。如果表已分区，则必须通过为分区列指定值，来确认数据加载的目标分区。</li><li>文件路径可以只指定一个文件（在这种情况下Hive会将文件移动到表中），也可以是一个目录（在这种情况下Hive会将该目录中的所有文件移动到表中）。</li><li>如果指定了关键字LOCAL，则： <ul><li>load命令将在本地文件系统中查找文件路径。如果指定了相对路径，它将相对于用户的当前工作目录进行解释。用户也可以为本地文件指定一个完整的URI，例如：<code>file:///user/hive/project/data1</code></li><li>load命令将尝试将指定的文件路径下的所有文件复制到目标文件系统。目标文件系统是通过查看表的位置属性来推断的。然后复制的数据文件到表中。</li><li>注意：如果对HiveServer2实例运行此命令，则本地路径指的是HiveServer2实例上的路径。HiveServer2必须具有访问该文件的适当权限。</li></ul></li><li>如果关键字LOCAL没有指定，那么Hive将使用filepath的完整URI，如果指定了一个，或者将应用以下规则： <ul><li>如果没有指定scheme或权限，Hive将使用hadoop配置的变量<code>fs.default.name</code>中的scheme和权限，该变量指定Namenode的URL</li><li>如果路径不是绝对的，那么Hive将相对于<code>/user/&lt;username&gt;</code>来解释它</li><li>Hive会把filepath寻址的文件移到表(或分区)中</li></ul></li><li>如果使用了OVERWRITE关键字，那么原目标表(或分区)中的内容将被删除，并被<em>filepath</em>引用的文件所取代；否则，<em>filepath</em>引用的文件将被添加到表中。</li></ul><p>Hive 3.0以后还支持额外的加载操作，因为Hive内部会将加载重写为INSERT as SELECT。</p><ul><li>如果表使用了分区，但是load命令没有分区，则load将被转换为INSERT AS SELECT，并假设最后一列是分区列。如果文件不符合预期的模式，就会报错。</li><li>如果表使用了分桶，则适用以下规则： <ul><li>严格模式：启动INSERT AS SELECT作业。</li><li>在非严格模式下：如果文件名符合命名约定(如果文件属于0桶，它应该命名为000000_0或000000_0_copy_1，或者如果它属于2桶，它应该命名为000002_0或000002_0_copy_3等)，那么它将是一个纯粹的复制/移动操作，否则它将启动一个INSERT AS SELECT作业。</li></ul></li><li><em>filepath</em> 可以包含子目录，前提是每个文件都符合规范。</li><li><em>inputformat</em> 可以是任何Hive输入格式，如文本，ORC等。</li><li><em>serde</em>可以是相关联的Hive serde。</li><li><em>inputformat</em>和<em>serde</em>都区分大小写。</li></ul><p>这是一个改模式的例子：</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tab1 <span class="token punctuation">(</span>col1 <span class="token keyword">int</span><span class="token punctuation">,</span> col2 <span class="token keyword">int</span><span class="token punctuation">)</span> PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col3 <span class="token keyword">int</span><span class="token punctuation">)</span> STORED <span class="token keyword">AS</span> ORC<span class="token punctuation">;</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&#39;filepath&#39;</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tab1<span class="token punctuation">;</span>
</code></pre></div><h5 id="load-其他" tabindex="-1"><a class="header-anchor" href="#load-其他" aria-hidden="true">#</a> Load 其他</h5><ul><li><em>filepath</em>不能包含子目录(Hive 3.0及以上版本除外，如上所述)。</li><li>如果没有给出关键字LOCAL，则<em>filepath</em>必须指与表(或分区)位置相同的文件系统中的文件。</li><li>Hive在加载前会做一些最小程度的检查，以确保加载的文件与目标表匹配。目前它检查表是否以sequencefile格式存储，正在加载的文件也是sequencefile。</li><li>在0.13.0版本(<a href="https://issues.apache.org/jira/browse/HIVE-6048" target="_blank" rel="noopener noreferrer">HIVE-6048</a>)中修复了文件名包含“+”字符时无法加载的错误。</li><li>如果数据文件是压缩类型的，请参阅<a href="https://cwiki.apache.org/confluence/display/Hive/CompressedStorage" target="_blank" rel="noopener noreferrer">CompressedStorage</a>。</li></ul><h3 id="insert" tabindex="-1"><a class="header-anchor" href="#insert" aria-hidden="true">#</a> Insert</h3><p>可以使用insert子句将查询结果插入到表中。</p><h5 id="insert-语法" tabindex="-1"><a class="header-anchor" href="#insert-语法" aria-hidden="true">#</a> Insert 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token comment">-- Standard syntax:</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> tablename1 <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span><span class="token punctuation">]</span> select_statement1 <span class="token keyword">FROM</span> 
<span class="token comment">-- from_statement:</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename1 <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> select_statement1 <span class="token keyword">FROM</span> from_statement<span class="token punctuation">;</span>
 
<span class="token comment">-- Hive extension (multiple inserts):</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename1 <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> select_statement1
<span class="token punctuation">[</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename2 <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> select_statement2<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> tablename2 <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span><span class="token punctuation">]</span> select_statement2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
 
<span class="token comment">-- Hive extension (dynamic partition inserts):</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> tablename <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token punctuation">[</span><span class="token operator">=</span>val1<span class="token punctuation">]</span><span class="token punctuation">,</span> partcol2<span class="token punctuation">[</span><span class="token operator">=</span>val2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> select_statement <span class="token keyword">FROM</span> from_statement<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token punctuation">[</span><span class="token operator">=</span>val1<span class="token punctuation">]</span><span class="token punctuation">,</span> partcol2<span class="token punctuation">[</span><span class="token operator">=</span>val2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> select_statement <span class="token keyword">FROM</span> from_statement<span class="token punctuation">;</span>
</code></pre></div><h5 id="insert-概要" tabindex="-1"><a class="header-anchor" href="#insert-概要" aria-hidden="true">#</a> Insert 概要</h5><ul><li><p>INSERT OVERWRITE 将覆盖表或分区中的任何现有数据</p><ul><li>除非为分区提供<code>IF NOT EXISTS</code>(从Hive <a href="https://issues.apache.org/jira/browse/HIVE-2612" target="_blank" rel="noopener noreferrer">0.9.0</a>开始)。</li><li>从 Hive 2.3.0版本开始 (<a href="https://issues.apache.org/jira/browse/HIVE-15880" target="_blank" rel="noopener noreferrer">HIVE-15880</a>)，如果表有<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-listTableProperties" target="_blank" rel="noopener noreferrer">TBLPROPERTIES</a> (&quot;auto.purge&quot;=&quot;true&quot;)，当对表运行INSERT OVERWRITE查询时，表中的原数据不会移动到Trash目录（此功能仅适用于内表）。</li></ul></li><li><p>INSERT INTO 会把数据追加到已有的表或分区中，不影响原来的数据。（注意：INSERT INTO 语法只在 0.8 版本以上支持。）</p><ul><li>从 Hive <a href="https://issues.apache.org/jira/browse/HIVE-6406" target="_blank" rel="noopener noreferrer">0.13.0</a> 开始，可以通过在创建表时添加 <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-CreateTable" target="_blank" rel="noopener noreferrer">TBLPROPERTIES (“immutable”=“true”)</a> 来设置表为不可变。默认值是 “immutable”=“false”。 如果不可变表中已经有数据了，就不能再用 INSERT INTO 向其中插入数据，但如果不可变表是空的，还是可以用 INSERT INTO 的。INSERT OVERWRITE 的行为不受 “immutable” 表属性的影响。 不可变表可以避免因为误操作而导致的数据更新。对不可变表的第一次插入会成功，之后的插入都会失败，这样就保证了表中只有一份数据，而不是重复地插入多份相同的数据。</li></ul></li><li><p>插入语句可以插入到表或分区中。如果表被分区，则必须通过为所有分区列指定值来指定表的特定分区。如果<a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.typecheck.on.insert" target="_blank" rel="noopener noreferrer">hive.typecheck.on.insert</a>设置为true，则这些值将被验证、转换并规范化以符合其列类型（从Hive <a href="https://issues.apache.org/jira/browse/HIVE-5297" target="_blank" rel="noopener noreferrer">0.12.0</a>开始）。</p></li><li><p>可以在同一查询中指定多个插入子句（也称为<em>多表插入</em>）。</p></li><li><p>每个select语句的输出都将写入所选表（或分区）。目前，OVERWRITE关键字是必需的，并意味着所选表或分区的内容将被相应select语句的输出替换。</p></li><li><p>输出格式和序列化类由表的元数据（通过DDL命令在表上指定）确定。</p></li><li><p>从<a href="https://issues.apache.org/jira/browse/HIVE-5317" target="_blank" rel="noopener noreferrer">Hive 0.14</a>开始，如果一个表具有实现AcidOutputFormat的OutputFormat，并且系统配置为使用实现ACID的<a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">transaction</a>管理器，则将禁用INSERT OVERWRITE。这是为了避免用户无意中覆盖事务历史。可以通过使用<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-TruncateTable" target="_blank" rel="noopener noreferrer">TRUNCATE TABLE</a>（对于非分区表）或<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-DropPartitions" target="_blank" rel="noopener noreferrer">DROP PARTITION</a>后跟INSERT INTO来实现相同的功能。</p></li><li><p>从Hive <a href="https://issues.apache.org/jira/browse/HIVE-9353" target="_blank" rel="noopener noreferrer">1.1.0</a>开始，TABLE关键字是可选的。</p></li><li><p>从Hive <a href="https://issues.apache.org/jira/browse/HIVE-9481" target="_blank" rel="noopener noreferrer">1.2.0</a>开始，每个INSERT INTO T都可以像INSERT INTO T (z, x, c1)一样带有列列表。有关示例，请参见<a href="https://issues.apache.org/jira/browse/HIVE-9481" target="_blank" rel="noopener noreferrer">HIVE-9481</a>的说明。</p></li><li><p>从Hive <a href="https://issues.apache.org/jira/browse/HIVE-19908" target="_blank" rel="noopener noreferrer">3.1.0</a>开始，不允许从具有全CRUD ACID表上的UNION ALL的源进行INSERT OVERWRITE。</p></li></ul><h5 id="insert-注意" tabindex="-1"><a class="header-anchor" href="#insert-注意" aria-hidden="true">#</a> Insert 注意</h5><ul><li>多表插入最小化了所需的数据扫描次数。Hive可以通过仅扫描一次输入数据（并应用不同的查询运算符）来将数据插入多个表中。</li><li>从Hive 0.13.0开始，select语句可以包括一个或多个公共表达式（CTE），如SELECT语法所示。有关示例，请参见Common Table Expression。</li></ul><h5 id="动态分区插入" tabindex="-1"><a class="header-anchor" href="#动态分区插入" aria-hidden="true">#</a> 动态分区插入</h5><div class="custom-container tip"><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path><path d="M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path></svg><p class="custom-container-title">版本信息</p><p>这些信息反映了Hive 0.12中的情况；动态分区插入是在Hive 0.6中添加的。</p></div><p>在动态分区插入中，用户可以给出部分分区规范，这意味着只在PARTITION子句中指定分区列名的列表。列值是可选的。如果给出分区列值，则称为静态分区，否则为动态分区。每个动态分区列都有一个对应的来自SELECT语句的输入列。这意味着动态分区创建是由输入列的值确定的。动态分区列必须在SELECT语句中的列中<strong>最后指定</strong>，并且在PARTITION()子句中以<strong>相同的顺序</strong>出现。从Hive 3.0.0（<a href="https://issues.apache.org/jira/browse/HIVE-19083" target="_blank" rel="noopener noreferrer">HIVE-19083</a>）开始，不需要指定动态分区列。如果未指定，则Hive将自动生成分区规范。</p><p>在Hive 0.9.0之前，默认情况下禁用动态分区插入，在Hive <a href="https://issues.apache.org/jira/browse/HIVE-2835" target="_blank" rel="noopener noreferrer">0.9.0</a>及更高版本中默认启用。以下是动态分区插入的相关配置属性：</p><table><thead><tr><th style="text-align:left;">配置属性</th><th style="text-align:left;">默认值</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>hive.exec.dynamic.partition</code></td><td style="text-align:left;"><code>true</code></td><td style="text-align:left;">需要设置为<code>true</code>以启用动态分区插入</td></tr><tr><td style="text-align:left;"><code>hive.exec.dynamic.partition.mode</code></td><td style="text-align:left;"><code>strict</code></td><td style="text-align:left;">在<code>strict</code>模式下，如果用户意外覆盖了所有分区，则用户必须指定至少一个静态分区，在<code>nonstrict</code>模式下，所有分区都允许是动态的</td></tr><tr><td style="text-align:left;"><code>hive.exec.max.dynamic.partitions.pernode</code></td><td style="text-align:left;">100</td><td style="text-align:left;">允许在每个mapper/reducer节点中创建的动态分区的最大数量</td></tr><tr><td style="text-align:left;"><code>hive.exec.max.dynamic.partitions</code></td><td style="text-align:left;">1000</td><td style="text-align:left;">允许创建的动态分区的最大数量</td></tr><tr><td style="text-align:left;"><code>hive.exec.max.created.files</code></td><td style="text-align:left;">100000</td><td style="text-align:left;">MapReduce作业中所有mapper/reducer创建的HDFS文件的最大数量</td></tr><tr><td style="text-align:left;"><code>hive.error.on.empty.partition</code></td><td style="text-align:left;"><code>false</code></td><td style="text-align:left;">如果动态分区插入生成空结果，则是否抛出异常</td></tr></tbody></table><p>例子</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">FROM</span> page_view_stg pvs
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> page_view <span class="token keyword">PARTITION</span><span class="token punctuation">(</span>dt<span class="token operator">=</span><span class="token string">&#39;2008-06-08&#39;</span><span class="token punctuation">,</span> country<span class="token punctuation">)</span>
       <span class="token keyword">SELECT</span> pvs<span class="token punctuation">.</span>viewTime<span class="token punctuation">,</span> pvs<span class="token punctuation">.</span>userid<span class="token punctuation">,</span> pvs<span class="token punctuation">.</span>page_url<span class="token punctuation">,</span> pvs<span class="token punctuation">.</span>referrer_url<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> pvs<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> pvs<span class="token punctuation">.</span>cnt
</code></pre></div><p>这里的<code>country</code>分区将由<code>SELECT</code>子句中的最后一列（即<code>pvs.cnt</code>）动态创建。请注意，名称未使用。在<code>nonstrict</code>模式下，<code>dt</code>分区也可以动态创建。</p><h3 id="insert-overwrite" tabindex="-1"><a class="header-anchor" href="#insert-overwrite" aria-hidden="true">#</a> Insert Overwrite</h3><p>查询结果可以通过使用下述语法插入到文件系统目录中：</p><h5 id="insert-overwrite-语法" tabindex="-1"><a class="header-anchor" href="#insert-overwrite-语法" aria-hidden="true">#</a> Insert Overwrite 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code>Standard syntax:
<span class="token keyword">INSERT</span> OVERWRITE <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> DIRECTORY directory1
  <span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span> <span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span> <span class="token punctuation">(</span>Note: Only available <span class="token keyword">starting</span> <span class="token keyword">with</span> Hive <span class="token number">0.11</span><span class="token number">.0</span><span class="token punctuation">)</span>
  <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
Hive extension <span class="token punctuation">(</span>multiple inserts<span class="token punctuation">)</span>:
<span class="token keyword">FROM</span> from_statement
<span class="token keyword">INSERT</span> OVERWRITE <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> DIRECTORY directory1 select_statement1
<span class="token punctuation">[</span><span class="token keyword">INSERT</span> OVERWRITE <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> DIRECTORY directory2 select_statement2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
  
row_format
  : DELIMITED <span class="token punctuation">[</span><span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span> <span class="token punctuation">[</span><span class="token keyword">ESCAPED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>COLLECTION ITEMS <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>MAP <span class="token keyword">KEYS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token boolean">NULL</span> DEFINED <span class="token keyword">AS</span> <span class="token keyword">char</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>Note: Only available <span class="token keyword">starting</span> <span class="token keyword">with</span> Hive <span class="token number">0.13</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="insert-overwrite-概要" tabindex="-1"><a class="header-anchor" href="#insert-overwrite-概要" aria-hidden="true">#</a> Insert Overwrite 概要</h5><ul><li>如果目录是完整的URI，则可以使用完整的URI。</li><li>如果未指定方案或权限，则Hive将使用hadoop配置变量fs.default.name中指定的Namenode URI的方案和权限。</li><li>如果使用LOCAL关键字，则Hive将数据写入本地文件系统上的目录。写入文件系统的数据被序列化为文本，其中列由^A分隔，行由换行符分隔。如果任何列不是原始类型，则这些列将序列化为JSON格式。</li><li>注意：INSERT OVERWRITE语句可以同时用于目录、本地目录和表（或分区）中。</li><li>从Hive 0.11.0开始，可以指定用作分隔符的字符；在早期版本中，它总是^A字符（\001）。但是，在Hive版本0.11.0到1.1.0中，仅支持LOCAL写入的自定义分隔符——此错误已在版本1.2.0中修复（请参见HIVE-5672）。</li><li>在Hive 0.14中，插入到ACID兼容表中的插入将在选择和插入期间停用矢量化。这将自动完成。仍然可以使用矢量化查询插入数据的ACID表。</li></ul><h3 id="insert-values" tabindex="-1"><a class="header-anchor" href="#insert-values" aria-hidden="true">#</a> Insert Values</h3><p>The INSERT…VALUES语句可通过SQL直接将数据插入表中。</p><div class="custom-container tip"><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path><path d="M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path></svg><p class="custom-container-title">版本信息</p><p>这是从<a href="https://issues.apache.org/jira/browse/HIVE-5317" target="_blank" rel="noopener noreferrer">Hive 0.14</a>开始提供的。</p></div><h5 id="insert-values-语法" tabindex="-1"><a class="header-anchor" href="#insert-values-语法" aria-hidden="true">#</a> Insert Values 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code>Standard Syntax:
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token punctuation">[</span><span class="token operator">=</span>val1<span class="token punctuation">]</span><span class="token punctuation">,</span> partcol2<span class="token punctuation">[</span><span class="token operator">=</span>val2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">VALUES</span> values_row <span class="token punctuation">[</span><span class="token punctuation">,</span> values_row <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
  
<span class="token keyword">Where</span> values_row <span class="token operator">is</span>:
<span class="token punctuation">(</span> <span class="token keyword">value</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword">value</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token keyword">where</span> a <span class="token keyword">value</span> <span class="token operator">is</span> either <span class="token boolean">null</span> <span class="token operator">or</span> <span class="token keyword">any</span> valid <span class="token keyword">SQL</span> literal
</code></pre></div><h5 id="insert-values-概要" tabindex="-1"><a class="header-anchor" href="#insert-values-概要" aria-hidden="true">#</a> Insert Values 概要</h5><ul><li>在VALUES子句中列出的每一行都将插入到表<em>tablename</em>中。</li><li>必须为表中的每一列提供值。尚不支持用户仅向某些列插入值的SQL语法。为实现类似的插入，可以为不希望分配值的列提供null。动态分区与<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82903069#LanguageManualDML-DynamicPartitionInserts" target="_blank" rel="noopener noreferrer">INSERT…SELECT</a>相同。</li><li>如果要插入的表支持<a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">ACID</a>，并且正在使用支持ACID的事务管理器，则此操作将在成功完成后自动提交。</li><li>Hive不支持复杂类型（数组、映射、结构、联合）的文字，因此不能在INSERT INTO…VALUES子句中使用它们。这意味着用户无法使用INSERT INTO…VALUES子句将数据插入到复杂数据类型列中。</li></ul><h5 id="insert-values-例子" tabindex="-1"><a class="header-anchor" href="#insert-values-例子" aria-hidden="true">#</a> Insert Values 例子</h5><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> students <span class="token punctuation">(</span>name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> age <span class="token keyword">INT</span><span class="token punctuation">,</span> gpa <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">CLUSTERED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">INTO</span> <span class="token number">2</span> BUCKETS STORED <span class="token keyword">AS</span> ORC<span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> students
  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;fred flintstone&#39;</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1.28</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;barney rubble&#39;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">2.32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> pageviews <span class="token punctuation">(</span>userid <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link STRING<span class="token punctuation">,</span> came_from STRING<span class="token punctuation">)</span>
  PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>datestamp STRING<span class="token punctuation">)</span> <span class="token keyword">CLUSTERED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>userid<span class="token punctuation">)</span> <span class="token keyword">INTO</span> <span class="token number">256</span> BUCKETS STORED <span class="token keyword">AS</span> ORC<span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> pageviews <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>datestamp <span class="token operator">=</span> <span class="token string">&#39;2014-09-23&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;jsmith&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sports.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;jdoe&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail.com&#39;</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> pageviews <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>datestamp<span class="token punctuation">)</span>
  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;tjohnson&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sports.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;finance.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2014-09-23&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;tlee&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;finance.com&#39;</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&#39;2014-09-21&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> pageviews
  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;tjohnson&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sports.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;finance.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2014-09-23&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;tlee&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;finance.com&#39;</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">&#39;2014-09-21&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> Update</h3><div class="custom-container tip"><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path><path d="M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path></svg><p class="custom-container-title">版本信息</p><p>UPDATE从<a href="https://issues.apache.org/jira/browse/HIVE-5317" target="_blank" rel="noopener noreferrer">Hive 0.14</a>开始提供。</p><p>只能在支持ACID的表上执行更新。有关详细信息，请参见<a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">Hive Transactions</a>。</p></div><h5 id="update-语法" tabindex="-1"><a class="header-anchor" href="#update-语法" aria-hidden="true">#</a> Update 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code>Standard Syntax:
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tablename <span class="token punctuation">[</span><span class="token keyword">WHERE</span> expression<span class="token punctuation">]</span>
</code></pre></div><h5 id="update-概要" tabindex="-1"><a class="header-anchor" href="#update-概要" aria-hidden="true">#</a> Update 概要</h5><ul><li><p>引用的列必须是正在更新的表的列。</p></li><li><p>分配的值必须是Hive在select子句中支持的表达式。因此，支持算术运算符、UDF、强制转换、文字等。不支持子查询。</p></li><li><p>只有与WHERE子句匹配的行才会更新。</p></li><li><p>无法更新分区列。</p></li><li><p>无法更新桶列。</p></li><li><p>在Hive 0.14中，此操作成功完成后将自动提交更改。</p></li><li><p>对于更新操作，将关闭矢量化。这是自动的，用户不需要采取任何措施。非更新操作不受影响。仍然可以使用矢量化查询更新的表。</p></li><li><p>在版本0.14中，建议在进行更新时将<a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.sort.dynamic.partition" target="_blank" rel="noopener noreferrer">hive.optimize.sort.dynamic.partition</a>=false，因为这会产生更有效的执行计划。</p></li></ul><h3 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> Delete</h3><div class="custom-container tip"><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path><path d="M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path></svg><p class="custom-container-title">版本信息</p><p>DELETE从<a href="https://issues.apache.org/jira/browse/HIVE-5317" target="_blank" rel="noopener noreferrer">Hive 0.14</a>开始提供。</p><p>只能在支持ACID的表上执行删除。有关详细信息，请参见<a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">Hive Transactions</a>。</p></div><h5 id="delete-语法" tabindex="-1"><a class="header-anchor" href="#delete-语法" aria-hidden="true">#</a> Delete 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code>Standard Syntax:
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tablename <span class="token punctuation">[</span><span class="token keyword">WHERE</span> expression<span class="token punctuation">]</span>
</code></pre></div><h5 id="delete-概要" tabindex="-1"><a class="header-anchor" href="#delete-概要" aria-hidden="true">#</a> Delete 概要</h5><ul><li>只有与WHERE子句匹配的行才会被删除。</li><li>在Hive 0.14中，此操作成功完成后将自动提交更改。</li></ul><h5 id="delete-其他" tabindex="-1"><a class="header-anchor" href="#delete-其他" aria-hidden="true">#</a> Delete 其他</h5><ul><li>对于删除操作，将关闭矢量化。这是自动的，用户不需要采取任何措施。非删除操作不受影响。仍然可以使用矢量化查询已删除数据的表。</li><li>在版本0.14中，建议在进行删除时将<a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.sort.dynamic.partition" target="_blank" rel="noopener noreferrer">hive.optimize.sort.dynamic.partition</a>=false，因为这会产生更有效的执行计划。</li></ul><h3 id="merge" tabindex="-1"><a class="header-anchor" href="#merge" aria-hidden="true">#</a> Merge</h3><div class="custom-container tip"><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M297.6 258.73H296c-59.47.87-110.69 51.45-111.83 110.43-.626 36.485 16.525 71.085 45.94 92.68 17.86 13.18 29.88 33.56 33.77 56.42h67.62c4-22.82 16.13-43.3 34.16-56.74 28.589-21.097 45.496-54.587 45.496-90.118 0-30.03-12.078-58.833-33.496-79.882a113.133 113.133 0 0 0-80.06-32.79ZM265.19 550.7v26.6c0 4.84 1.17 6.43 1.17 6.43l63.72-.59V550.7h-64.89Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path><path d="M297.64 123.3C133.26 123.3 0 256.56 0 420.94s133.26 297.63 297.64 297.63 297.63-133.25 297.63-297.63S462 123.3 297.64 123.3ZM385 487.57c-14.11 10.48-22.51 28.09-22.51 47.14v48.43c-.016 17.792-14.648 32.428-32.44 32.45h-64.86c-15.6 0-32.44-12-32.44-38.29v-42.82c0-19-8.21-36.4-21.93-46.52-37.882-27.85-59.959-72.44-59.14-119.45 1.46-77.24 66-141.09 143.81-142.22 38.87.19 76.89 14.37 105 42.11a143.764 143.764 0 0 1 43.14 103c-.159 45.761-21.911 88.86-58.63 116.17Z" style="fill:#48b884;fill-rule:nonzero;" transform="matrix(.042 0 0 .042 0 -5.178)"></path></svg><p class="custom-container-title">版本信息</p><p>MERGE从<a href="https://issues.apache.org/jira/browse/HIVE-10924" target="_blank" rel="noopener noreferrer">Hive 2.2</a>开始提供。</p><p>只能在支持ACID的表上执行合并。有关详细信息，请参见<a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">Hive Transactions</a>。</p></div><h5 id="merge-语法" tabindex="-1"><a class="header-anchor" href="#merge-语法" aria-hidden="true">#</a> Merge 语法</h5><div class="language-sql ext-sql"><pre class="language-sql"><code>Standard Syntax:
<span class="token keyword">MERGE</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>target <span class="token keyword">table</span><span class="token operator">&gt;</span> <span class="token keyword">AS</span> T <span class="token keyword">USING</span> <span class="token operator">&lt;</span>source expression<span class="token operator">/</span><span class="token keyword">table</span><span class="token operator">&gt;</span> <span class="token keyword">AS</span> S
<span class="token keyword">ON</span> <span class="token operator">&lt;</span><span class="token keyword">boolean</span> expression1<span class="token operator">&gt;</span>
<span class="token keyword">WHEN</span> <span class="token keyword">MATCHED</span> <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token operator">&lt;</span><span class="token keyword">boolean</span> expression2<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> <span class="token keyword">SET</span> <span class="token operator">&lt;</span><span class="token keyword">set</span> clause list<span class="token operator">&gt;</span>
<span class="token keyword">WHEN</span> <span class="token keyword">MATCHED</span> <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token operator">&lt;</span><span class="token keyword">boolean</span> expression3<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token keyword">THEN</span> <span class="token keyword">DELETE</span>
<span class="token keyword">WHEN</span> <span class="token operator">NOT</span> <span class="token keyword">MATCHED</span> <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token operator">&lt;</span><span class="token keyword">boolean</span> expression4<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token keyword">THEN</span> <span class="token keyword">INSERT</span> <span class="token keyword">VALUES</span><span class="token operator">&lt;</span><span class="token keyword">value</span> list<span class="token operator">&gt;</span>
</code></pre></div><h5 id="merge-说明" tabindex="-1"><a class="header-anchor" href="#merge-说明" aria-hidden="true">#</a> Merge 说明</h5><ul><li><a href="https://en.wikipedia.org/wiki/Merge_(SQL)" target="_blank" rel="noopener noreferrer">Merge</a>允许根据与源表的联接结果对目标表执行操作。</li><li>在Hive 2.2中，此操作成功完成后将自动提交更改。</li><li>SQL标准要求，如果ON子句是这样的：即源中的多行与目标中的一行匹配，则会引发错误。此检查计算成本高昂，可能会显着影响MERGE语句的总运行时间。设置<a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.merge.cardinality.check" target="_blank" rel="noopener noreferrer">hive.merge.cardinality.check</a>=false可以用于自行承担风险禁用检查。如果禁用了检查，但语句具有这种交叉连接效果，则可能导致数据损坏。</li><li>可以存在1、2或3个WHEN子句；每种类型最多1个：UPDATE/DELETE/INSERT。</li><li>WHEN NOT MATCHED必须是最后一个WHEN子句。</li><li>如果UPDATE和DELETE子句都存在，则语句中的第一个子句必须包括AND子句。</li><li>对于合并操作，将关闭矢量化。这是自动的，用户不需要采取任何措施。非删除操作不受影响。仍然可以使用矢量化查询已删除数据的表。</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><div class="pager"><a href="/post/2022/12/Hive%20%E8%AF%AD%E8%A8%80%E6%89%8B%E5%86%8C-DDL%E7%AF%87/" class="prev">Previous <br><span>Hive 基本概念 DDL篇</span></a><!----></div><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-3 toc-link-load">Load</li><li class="level-3 toc-link-insert">Insert</li><li class="level-3 toc-link-insert-overwrite">Insert Overwrite</li><li class="level-3 toc-link-insert-values">Insert Values</li><li class="level-3 toc-link-update">Update</li><li class="level-3 toc-link-delete">Delete</li><li class="level-3 toc-link-merge">Merge</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div title="toggle color mode" class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
                  &copy; Xiaobailong 2022-2023
                  <br>
                  Powered by <a href="https://vuepress.vuejs.org" target="_blank">VuePress</a> &
                  <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
                </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.7f79d2e7.js" defer></script>
  </body>
</html>
